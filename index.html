document.getElementById("formPonto").addEventListener("submit", async (e) => {
  e.preventDefault();
  const mensagem = document.getElementById("mensagem");
  
  try {
    mensagem.textContent = "Processando...";
    mensagem.style.color = "blue";
    
    // 1. Coletar dados do formulário
    const formData = {
      nome: e.target.nome.value,
      setor: e.target.setor.value,
      tipo: e.target.tipo.value,
      obs: e.target.obs.value,
      latitude: document.getElementById('latitude').value || '0',
      longitude: document.getElementById('longitude').value || '0'
    };

    // 2. Configurar a requisição
    const webAppUrl = "SUA_URL_DO_WEB_APP_AQUI"; // Substitua pela sua URL
    const response = await fetch(webAppUrl, {
      method: 'POST',
      mode: 'no-cors', // Contorna problemas de CORS
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams(formData).toString()
    });

    // 3. Processar resposta
    const result = await response.text();
    mensagem.textContent = result.includes('success') ? 
      '✅ Ponto registrado com sucesso!' : 
      '⚠️ ' + result;
    mensagem.style.color = result.includes('success') ? 'green' : 'orange';
    
  } catch (error) {
    console.error('Erro detalhado:', error);
    mensagem.innerHTML = `❌ Erro ao enviar:<br>
      <small>${error.message}</small><br>
      <button onclick="window.location.reload()">Tentar Novamente</button>`;
    mensagem.style.color = 'red';
  }
});
