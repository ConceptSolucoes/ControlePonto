<script>
  // Obter localização
  navigator.geolocation.getCurrentPosition(position => {
    document.getElementById('latitude').value = position.coords.latitude;
    document.getElementById('longitude').value = position.coords.longitude;
  }, error => {
    console.warn("Localização não disponível:", error);
    document.getElementById('mensagem').textContent = 
      "Localização não disponível. O ponto será registrado sem geolocalização.";
    document.getElementById('mensagem').style.color = "orange";
  });

  // Envio do formulário
  document.getElementById("formPonto").addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const form = e.target;
    const messageEl = document.getElementById("mensagem");
    messageEl.textContent = "Enviando dados...";
    messageEl.style.color = "blue";
    
    try {
      // Converter FormData para objeto
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => data[key] = value);
      
      // URL do Web App (substitua pela sua)
      const webAppUrl = "https://script.google.com/macros/s/AKfycb.../exec";
      
      const response = await fetch(webAppUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
        redirect: "follow"
      });
      
      const result = await response.json();
      
      if (result.status === "success") {
        messageEl.textContent = result.message;
        messageEl.style.color = "green";
        form.reset();
      } else {
        throw new Error(result.message);
      }
    } catch (error) {
      console.error("Erro:", error);
      messageEl.textContent = `Erro: ${error.message}`;
      messageEl.style.color = "red";
      
      // Sugestão para o usuário
      setTimeout(() => {
        messageEl.textContent += " Tente novamente ou entre em contato com o RH.";
      }, 2000);
    }
  });
</script>
